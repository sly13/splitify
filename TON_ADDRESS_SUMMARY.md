# üìã –†–µ–∑—é–º–µ: –§–æ—Ä–º–∞—Ç—ã –∞–¥—Ä–µ—Å–æ–≤ TON

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

### 1. **Raw —Ñ–æ—Ä–º–∞—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è)**

```
0:83dfd552e63729b471fc03dca9e96bfd0197afbe46e2112b5eb4f24868b51e0f
```

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** `workchain:hash`
- **Workchain:** 0 (–æ—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç—å) –∏–ª–∏ -1 (—Ç–µ—Å—Ç–æ–≤–∞—è —Å–µ—Ç—å)
- **Hash:** 64 —Å–∏–º–≤–æ–ª–∞ hex (0-9, a-f)
- **–î–ª–∏–Ω–∞:** 67 —Å–∏–º–≤–æ–ª–æ–≤ (2 + 1 + 64)

### 2. **User-friendly —Ñ–æ—Ä–º–∞—Ç (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)**

```
UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH
EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH
```

- **UQ:** Bounceable –∞–¥—Ä–µ—Å (–º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
- **EQ:** Non-bounceable –∞–¥—Ä–µ—Å (–Ω–µ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞)
- **–î–ª–∏–Ω–∞:** 48 —Å–∏–º–≤–æ–ª–æ–≤
- **–û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã:** Base64url (A-Z, a-z, 0-9, \_, -)

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–°–æ–∑–¥–∞–Ω–∞ —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** (`/backend/src/utils/tonAddress.ts`)

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ raw —Ñ–æ—Ä–º–∞—Ç–∞ (workchain:hash)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ user-friendly —Ñ–æ—Ä–º–∞—Ç–∞ (UQ/EQ)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è workchain (—Ç–æ–ª—å–∫–æ 0 –∏–ª–∏ -1)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è hash (64 hex —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ base64url –¥–ª—è UQ/EQ —Ñ–æ—Ä–º–∞—Ç–∞

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DeepLink**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é `createTonPaymentDeeplink`
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### 3. **–£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ API**

- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `/api/user/profile`
- ‚úÖ –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –∞–¥—Ä–µ—Å–∞

## üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### **–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

```sql
-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ raw —Ñ–æ—Ä–º–∞—Ç–µ
tonWalletAddress VARCHAR(67) -- "0:" + 64 hex —Å–∏–º–≤–æ–ª–∞
```

### **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**

```typescript
// –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è UI
formatTonAddressForDisplay(address); // "0:83dfd5...51e0f"
```

### **Deep Links –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π:**

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫
createTonPaymentDeeplink(address, amount, comment);
// "ton://transfer/0:83dfd552...?amount=1000000000&text=Payment"
```

### **API –∑–∞–ø—Ä–æ—Å—ã –∫ TON:**

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º raw —Ñ–æ—Ä–º–∞—Ç –¥–ª—è TON API
const tonApiUrl = `https://tonapi.io/v2/accounts/${rawAddress}/events`;
```

## üö® –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. **–°—Ç–∞—Ä–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º —Å–ª–∞–±–æ–π:**

```typescript
// ‚ùå –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–ª –ª—é–±—ã–µ 48-—Å–∏–º–≤–æ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
const tonAddressRegex = /^(UQ|EQ)[A-Za-z0-9_-]{46}$/;
return tonAddressRegex.test(address) || address.length === 48; // –û–ø–∞—Å–Ω–æ!
```

### 2. **–ù–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä–æ–≥–∞—è:**

```typescript
// ‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞
function isValidTonAddress(address: string): boolean {
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç workchain (0 –∏–ª–∏ -1)
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç hash (64 hex —Å–∏–º–≤–æ–ª–∞)
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç base64url –¥–ª—è UQ/EQ
}
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–¥—Ä–µ—Å–æ–≤:**

```sql
-- –ù–∞–π—Ç–∏ –≤—Å–µ –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–æ–≤
SELECT id, tonWalletAddress FROM users WHERE tonWalletAddress IS NOT NULL;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ö –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å (–Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç)
```

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

```sql
-- –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª–∏–Ω—É –ø–æ–ª—è –¥–ª—è raw —Ñ–æ—Ä–º–∞—Ç–∞
ALTER TABLE users ALTER COLUMN tonWalletAddress TYPE VARCHAR(67);
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤

### **Raw —Ñ–æ—Ä–º–∞—Ç (–¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è):**

```
0:83dfd552e63729b471fc03dca9e96bfd0197afbe46e2112b5eb4f24868b51e0f
-1:83dfd552e63729b471fc03dca9e96bfd0197afbe46e2112b5eb4f24868b51e0f
```

### **User-friendly —Ñ–æ—Ä–º–∞—Ç (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è):**

```
UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH
EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH
```

### **Deep Link –¥–ª—è –ø–ª–∞—Ç–µ–∂–∞:**

```
ton://transfer/0:83dfd552e63729b471fc03dca9e96bfd0197afbe46e2112b5eb4f24868b51e0f?amount=1000000000&text=Split%20Bill%20Payment%20-%20bill_cmfqzvmd000035xoj9e574idg
```

## ‚úÖ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é** –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ raw —Ñ–æ—Ä–º–∞—Ç–∞
3. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥—Ä–µ—Å–∞** –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
4. **–î–æ–±–∞–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É TON** –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
5. **–û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏
